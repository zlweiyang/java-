# 《深入理解JVM虚拟机》 #

# 1.Java虚拟机运行时数据区域 #

## - 程序计数器 ##

记录当前线程所执行的字节码行号，用于获取下一条执行的字节码，Java虚拟机的多线程是通过轮流切换和分配处理器时间来实现的，为了线程切换后能够恢复到正确的位置，每个线程都需要有一个独立的程序计数器，所以程序计数器是**线程私有**的。

线程执行Java方法，这个计数器记录的是正在执行的虚拟机字节码，如果执行Native方法，这计数器为空。**程序计数器是唯一一个在Java虚拟机规范中没有规定任何OutOfMemoryError内存溢出错误的区域。**

## - Java虚拟机栈 ##

Java虚拟机栈也是线程私有，生命周期与线程相同，虚拟机栈描述的是Java方法执行的内存模型：每个方法在执行的时候都会同时创建一个栈帧用于存储局部变量表、操作栈、动态链接、方法出口等信息。每个方法被调用直至执行完成的过程，就对应于栈帧在虚拟机栈中从入栈到出栈的过程。

局部变量表存放在编译时可知的八种基本数据类(boolean,byte,short,int,char,long,float,double),对象引用和returnAddress类型。

long,double为64长度的数据占用2个局部变量空间，其余数据类型只占1个局部变量空间，局部变量内存空间在编译期间完成分配。

两种异常：当线程请求的栈深度大于虚拟机锁允许的深度，将抛出StackoverflowError异常，
当虚拟机动态扩展无法申请足够的内存时(大部分虚拟机可动态扩展，也允许固定长度的虚拟机栈)，将会抛出OutOfMemoryError异常。